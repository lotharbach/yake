{{- $secrets := dict }}
{{- $sec := lookup "v1" "Secret" "garden" "gardener-internal" }}
{{- if or $sec $sec.data }}
{{- $secrets = (index $sec.data "kubeconfig") | b64dec | fromYaml }}
{{- end }}


apiVersion: v1
kind: Secret
metadata:
  name: gardenlet-bootstrap-kubeconfig
  namespace: garden
type: Opaque
stringData:
  kubeconfig: |
    apiVersion: v1
    kind: Config
    current-context: gardenlet-bootstrap@default
    clusters:
    - cluster:
        certificate-authority-data: {{ index (first $secrets.clusters).cluster "certificate-authority-data" }}
        server: {{ index (first $secrets.clusters).cluster "server" }}
      name: default
    contexts:
    - context:
        cluster: default
        user: gardenlet-bootstrap
      name: gardenlet-bootstrap@default
    users:
    - name: gardenlet-bootstrap
      user:
        token: 07401b.f395accd246ae52d
